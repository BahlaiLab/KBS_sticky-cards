oldcard_boxplot
oldcard_boxplot <- ggarrange(richness.plot, abundance.plot, diversity.plot, evenness.plot,
ncol = 2, nrow = 2,
common.legend = TRUE, legend = "bottom")
annotate_figure(oldcard_boxplot, top = text_grob("Old cards between years",
color = "black", face = "bold", size = 14))
oldcard_boxplot <- ggarrange(richness.plot, abundance.plot, diversity.plot, evenness.plot,
ncol = 2, nrow = 2,
common.legend = TRUE, legend = "bottom")
annotate_figure(oldcard_boxplot, top = text_grob("Old cards between years",
color = "black", face = "bold", size = 12))
oldcard_boxplot <- ggarrange(richness.plot, abundance.plot, diversity.plot, evenness.plot,
ncol = 2, nrow = 2,
common.legend = TRUE, legend = "bottom")
annotate_figure(oldcard_boxplot, top = text_grob("Old cards between years",
color = "black", face = "bold", size = 13))
oldcard_boxplot
oldcard_boxplot <- ggarrange(richness.plot, abundance.plot, diversity.plot, evenness.plot,
ncol = 2, nrow = 2,
common.legend = TRUE, legend = "bottom")
annotate_figure(oldcard_boxplot, top = text_grob("Old cards between years",
color = "black", face = "bold", size = 13))
pdf("oldcard_boxplot.pdf", height=8, width=8) #height and width in inches
oldcard_boxplot
dev.off()
oldcard_boxplot <- ggarrange(richness.plot, abundance.plot, diversity.plot, evenness.plot,
ncol = 2, nrow = 2,
common.legend = TRUE, legend = "bottom")
oldcard_boxplot2 <- annotate_figure(oldcard_boxplot, top = text_grob("Old cards between years",
color = "black", face = "bold", size = 13))
pdf("oldcard_boxplot.pdf", height=8, width=8) #height and width in inches
oldcard_boxplot2
dev.off()
pdf("oldcard_boxplot.pdf", height=8, width=8) #height and width in inches
oldcard_boxplot
dev.off()
#ABIPN
ABIPN<-old20_old21[c(1:6,25)]
ABIPN.glm<-glm(ABIPN ~ CARDYEAR + week + TREAT + offset(TRAPS), data=ABIPN, family=poisson)
summary(ABIPN.glm)
#BURSI
BURSI<-old20_old21[c(1:5,7,25)]
BURSI.glm<-glm(BURSI ~ CARDYEAR + week + TREAT + offset(TRAPS), data=BURSI, family=poisson)
summary(BURSI.glm)
Anova (BURSI.glm)
#C7
C7<-old20_old21[c(1:5,8,25)]
C7.glm<-glm(C7 ~ CARDYEAR + week + TREAT + offset(TRAPS), data=C7, family=poisson)
summary(C7.glm)
Anova (C7.glm)
#CMAC
CMAC<-old20_old21[c(1:5,9,25)]
glm<-glm(CMAC ~ CARDYEAR + week + TREAT + offset(TRAPS), data=CMAC, family=poisson)
summary(glm)
Anova (glm)
#CSTIG
CSTIG<-old20_old21[c(1:5,10,25)]
glm<-glm(CSTIG ~ CARDYEAR + week + TREAT + offset(TRAPS), data=CSTIG, family=poisson)
summary(glm)
Anova(glm)
#CTRIF
CTRIF<-old20_old21[c(1:5,11,25)]
glm<-glm(CTRIF ~ CARDYEAR + week + TREAT + offset(TRAPS), data=CTRIF, family=poisson)
summary(glm)
Anova (glm)
#CYCSP
CYCSP<-old20_old21[c(1:5,12,25)]
glm<-glm(CYCSP ~ CARDYEAR + week + TREAT + offset(TRAPS), data=CYCSP, family=poisson)
summary(glm)
Anova (glm)
#H13
H13<-old20_old21[c(1:5,13,25)]
glm<-glm(H13 ~ CARDYEAR + week + TREAT + offset(TRAPS), data=H13, family=poisson)
summary(glm)
Anova (glm)
Anova (glm)
#HAXY
HAXY<-old20_old21[c(1:5,14,25)]
glm<-glm(HAXY ~ CARDYEAR + week + TREAT + offset(TRAPS), data=HAXY, family=poisson)
summary(glm)
Anova (glm)
#HCONV
HCONV<-old20_old21[c(1:5,15,25)]
glm<-glm(HCONV ~ CARDYEAR + week + TREAT + offset(TRAPS), data=HCONV, family=poisson)
summary(glm)
Anova (glm)
#HGLAC
HGLAC<-old20_old21[c(1:5,16,25)]
glm<-glm(HGLAC ~ CARDYEAR + week + TREAT + offset(TRAPS), data=HGLAC, family=poisson)
summary(glm)
Anova (glm)
#HPARN
HPARN<-old20_old21[c(1:5,17,25)]
glm<-glm(HPARN ~ CARDYEAR + week + TREAT + offset(TRAPS), data=HPARN, family=poisson)
summary(glm)
Anova (glm)
#HVAR
HVAR<-old20_old21[c(1:5,18,25)]
glm<-glm(HVAR ~ CARDYEAR + week + TREAT + offset(TRAPS), data=HVAR, family=poisson)
summary(glm)
Anova (glm)
#PQUA
PQUA<-old20_old21[c(1:5,19,25)]
glm<-glm(PQUA ~ CARDYEAR + week + TREAT + offset(TRAPS), data=PQUA, family=poisson)
summary(glm)
Anova (glm)
#CANTHARID
CANTHARID<-old20_old21[c(1:5,20,25)]
glm<-glm(CANTHARID ~ CARDYEAR + week + TREAT + offset(TRAPS), data=CANTHARID, family=poisson)
summary(glm)
Anova (glm)
#LAMPY
LAMPY<-old20_old21[c(1:5,21,25)]
glm<-glm(LAMPY ~ CARDYEAR + week + TREAT + offset(TRAPS), data=LAMPY, family=poisson)
summary(glm)
Anova (glm)
#LCW
LCW<-old20_old21[c(1:5,22,25)]
glm<-glm(LCW ~ CARDYEAR + week + TREAT + offset(TRAPS), data=LCW, family=poisson)
summary(glm)
Anova (glm)
#MECOP
MECOP<-old20_old21[c(1:5,23,25)]
glm<-glm(MECOP ~ CARDYEAR + week + TREAT + offset(TRAPS), data=MECOP, family=poisson)
summary(glm)
Anova (glm)
#X20SPOT
X20SPOT<-old20_old21[c(1:5,24,25)]
glm<-glm(X20SPOT ~ CARDYEAR + week + TREAT + offset(TRAPS), data=X20SPOT, family=poisson)
summary(glm)
Anova (glm)
new21 <- insects_all[which(insects_all$CARDYEAR=="New21"),]
new22 <- insects_all[which(insects_all$CARDYEAR=="New22"),]
#combine
library (plyr)
new21_new22 <- rbind.fill (new21, new22)
insects.rowsums <- rowSums(new21_new22[,6:24]>0)
new21_new22$richness <- insects.rowsums
#To obtain abundance counts
insects.abun <- rowSums(new21_new22[,6:24])
new21_new22$abundance <- insects.abun
#calculate Shannon diversity
diversity <-diversity(new21_new22[,6:24])
new21_new22$diversity <-diversity
#calculate Evenness
evenness <-diversity/log(specnumber(new21_new22[,6:24]))
new21_new22$evenness <- evenness
#richness
#AIC 1234
richness.model<-glm(richness ~ CARDYEAR + week + TREAT + offset(TRAPS), data=new21_new22, family=poisson)
summary(richness.model)
Anova (richness.model)
#CARDYEAR: not sig , week and treatment: sig
#results: no sig diff btw cards (p=0.28)
AIC(richness.model)
#abundance
##AIC 2695
abundance.model<-glm(abundance ~ CARDYEAR + week + TREAT + offset(TRAPS), data=new21_new22, family=poisson)
summary(abundance.model)
Anova(abundance.model)
#diversity
##AIC 569
diversity.model<-glm(diversity ~ CARDYEAR + week + TREAT + offset(TRAPS), data=new21_new22)
summary(diversity.model)
Anova(diversity.model)
#evenness
##AIC Inf
evenness.model<-glm(evenness ~ CARDYEAR + week + TREAT + offset(TRAPS), data=new21_new22, family = poisson)
summary(evenness.model)
Anova(evenness.model)
#CARDYEAR richness by card type
richness.plot<-ggplot(new21_new22, aes(x = factor(CARDYEAR), y = richness, fill=CARDYEAR))+
geom_boxplot()+
theme_bw()+
theme(legend.position="bottom")+
labs(title="", x="", y="Richness")+
#theme (plot.title = element_text(hjust=0.5))+
scale_fill_manual(values=c("#ffba21","#E69F00","#009E73","#00c690"),name="Card:",
breaks=c("Old20", "Old21", "New21", "New22"),
labels=c("Old cards 2020", "Old cards 2021", "New cards 2021", "New cards 2022"))
richness.plot
#CARDYEAR abundance by card type
abundance.plot<-ggplot(new21_new22, aes(x = factor(CARDYEAR), y = abundance, fill=CARDYEAR))+
geom_boxplot()+
theme_bw()+
theme(legend.position="bottom")+
labs(title="", x="", y="Abundance (log10)")+
scale_y_continuous(trans="log10")+
#theme (plot.title = element_text(hjust=0.5))+
scale_fill_manual(values=c("#ffba21","#E69F00","#009E73","#00c690"),name="Card:",
breaks=c("Old20", "Old21", "New21", "New22"),
labels=c("Old cards 2020", "Old cards 2021", "New cards 2021", "New cards 2022"))
abundance.plot
#CARDYEAR diveristy by card type
diversity.plot<-ggplot(new21_new22, aes(x = factor(CARDYEAR), y = diversity, fill=CARDYEAR))+
geom_boxplot()+
theme_bw()+
theme(legend.position="bottom")+
labs(title="", x="", y="Shannon diversity")+
#theme (plot.title = element_text(hjust=0.5))+
scale_fill_manual(values=c("#ffba21","#E69F00","#009E73","#00c690"),name="Card:",
breaks=c("Old20", "Old21", "New21", "New22"),
labels=c("Old cards 2020", "Old cards 2021", "New cards 2021", "New cards 2022"))
diversity.plot
#CARDYEAR evenness by card type
evenness.plot<-ggplot(new21_new22, aes(x = factor(CARDYEAR), y = evenness, fill=CARDYEAR))+
geom_boxplot()+
theme_bw()+
theme(legend.position="bottom")+
labs(title="", x="", y="Evenness")+
#theme (plot.title = element_text(hjust=0.5))+
scale_fill_manual(values=c("#ffba21","#E69F00","#009E73","#00c690"),name="Card:",
breaks=c("Old20", "Old21", "New21", "New22"),
labels=c("Old cards 2020", "Old cards 2021", "New cards 2021", "New cards 2022"))
evenness.plot
#
#mush together plots
library(ggpubr)
newcard_boxplot <- ggarrange(richness.plot, abundance.plot, diversity.plot, evenness.plot,
ncol = 2, nrow = 2,
common.legend = TRUE, legend = "bottom")
newcard_boxplot
pdf("newcard_boxplot.pdf", height=8, width=8) #height and width in inches
newcard_boxplot
dev.off()
#ABIPN
ABIPN<-new21_new22[c(1:6,25)]
ABIPN.glm<-glm(ABIPN ~ CARDYEAR + week + TREAT + offset(TRAPS), data=ABIPN, family=poisson)
summary(ABIPN.glm)
Anova (ABIPN.glm)
#BURSI
BURSI<-new21_new22[c(1:5,7,25)]
BURSI.glm<-glm(BURSI ~ CARDYEAR + week + TREAT + offset(TRAPS), data=BURSI, family=poisson)
summary(BURSI.glm)
Anova (BURSI.glm)
#C7
C7<-new21_new22[c(1:5,8,25)]
C7.glm<-glm(C7 ~ CARDYEAR + week + TREAT + offset(TRAPS), data=C7, family=poisson)
summary(C7.glm)
Anova (C7.glm)
#CMAC
CMAC<-new21_new22[c(1:5,9,25)]
glm<-glm(CMAC ~ CARDYEAR + week + TREAT + offset(TRAPS), data=CMAC, family=poisson)
summary(glm)
Anova (glm)
#CSTIG
CSTIG<-new21_new22[c(1:5,10,25)]
glm<-glm(CSTIG ~ CARDYEAR + week + TREAT + offset(TRAPS), data=CSTIG, family=poisson)
summary(glm)
Anova(glm)
#CTRIF
CTRIF<-new21_new22[c(1:5,11,25)]
glm<-glm(CTRIF ~ CARDYEAR + week + TREAT + offset(TRAPS), data=CTRIF, family=poisson)
summary(glm)
Anova (glm)
#CYCSP
CYCSP<-new21_new22[c(1:5,12,25)]
glm<-glm(CYCSP ~ CARDYEAR + week + TREAT + offset(TRAPS), data=CYCSP, family=poisson)
summary(glm)
Anova (glm)
#H13
H13<-new21_new22[c(1:5,13,25)]
glm<-glm(H13 ~ CARDYEAR + week + TREAT + offset(TRAPS), data=H13, family=poisson)
summary(glm)
Anova (glm)
#HAXY
HAXY<-new21_new22[c(1:5,14,25)]
glm<-glm(HAXY ~ CARDYEAR + week + TREAT + offset(TRAPS), data=HAXY, family=poisson)
summary(glm)
Anova (glm)
#HCONV
HCONV<-new21_new22[c(1:5,15,25)]
glm<-glm(HCONV ~ CARDYEAR + week + TREAT + offset(TRAPS), data=HCONV, family=poisson)
summary(glm)
Anova (glm)
#HGLAC
HGLAC<-new21_new22[c(1:5,16,25)]
glm<-glm(HGLAC ~ CARDYEAR + week + TREAT + offset(TRAPS), data=HGLAC, family=poisson)
summary(glm)
Anova (glm)
#HPARN
HPARN<-new21_new22[c(1:5,17,25)]
glm<-glm(HPARN ~ CARDYEAR + week + TREAT + offset(TRAPS), data=HPARN, family=poisson)
summary(glm)
Anova (glm)
#HVAR
HVAR<-new21_new22[c(1:5,18,25)]
glm<-glm(HVAR ~ CARDYEAR + week + TREAT + offset(TRAPS), data=HVAR, family=poisson)
summary(glm)
Anova (glm)
#PQUA
PQUA<-new21_new22[c(1:5,19,25)]
glm<-glm(PQUA ~ CARDYEAR + week + TREAT + offset(TRAPS), data=PQUA, family=poisson)
summary(glm)
Anova (glm)
#CANTHARID
CANTHARID<-new21_new22[c(1:5,20,25)]
glm<-glm(CANTHARID ~ CARDYEAR + week + TREAT + offset(TRAPS), data=CANTHARID, family=poisson)
summary(glm)
Anova (glm)
#LAMPY
LAMPY<-new21_new22[c(1:5,21,25)]
glm<-glm(LAMPY ~ CARDYEAR + week + TREAT + offset(TRAPS), data=LAMPY, family=poisson)
summary(glm)
Anova (glm)
#LCW
LCW<-new21_new22[c(1:5,22,25)]
glm<-glm(LCW ~ CARDYEAR + week + TREAT + offset(TRAPS), data=LCW, family=poisson)
summary(glm)
Anova (glm)
#MECOP
MECOP<-new21_new22[c(1:5,23,25)]
glm<-glm(MECOP ~ CARDYEAR + week + TREAT + offset(TRAPS), data=MECOP, family=poisson)
summary(glm)
Anova (glm)
#X20SPOT
X20SPOT<-new21_new22[c(1:5,24,25)]
glm<-glm(X20SPOT ~ CARDYEAR + week + TREAT + offset(TRAPS), data=X20SPOT, family=poisson)
summary(glm)
Anova (glm)
#bring in data from all years
insects_all <- read.csv("https://raw.githubusercontent.com/BahlaiLab/KBS_sticky-cards/main/all%20years_LTER_for_analyses.csv", na.strings = NULL)
#change week, CARD, TREAT, and STATION to factor
insects_all$week <- as.factor(insects_all$week)
insects_all$CARDYEAR <- as.factor(insects_all$CARDYEAR)
insects_all$CARD <- as.factor(insects_all$CARD)
insects_all$TREAT <- as.factor(insects_all$TREAT)
insects_all$STATION <- as.factor(insects_all$STATION)
str(insects_all)
summary(insects_all)
new21 <- insects_all[which(insects_all$CARDYEAR=="New21"),]
new22 <- insects_all[which(insects_all$CARDYEAR=="New22"),]
#combine
library (plyr)
new21_new22 <- rbind.fill (new21, new22)
#NMDS of insect community between New21 and New22 cards
library (vegan)
insects.abun <- rowSums(new21_new22[,6:24])
new21_new22$abundance <- insects.abun
#then remove rows = zero
new21_new22_nonzero <- new21_new22[rowSums(new21_new22[26])>0,]
str(new21_new22_nonzero)
env.matrix<-new21_new22_nonzero[c(1:5,25)]
#create matrix of community variables
com.matrix<-new21_new22_nonzero[c(6:24)]
#ordination by NMDS
#ordination by NMDS
NMDSnew<-metaMDS(com.matrix, distance="bray", k=2, autotransform=TRUE, trymax=100) #stress=.23
NMDSnew
plot(NMDSnew, disp='sites', type="n")
title(main="", adj = 0.01, line = -2, cex.main=2.5)
#add ellipsoids with ordiellipse
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#00c690",kind="sd", conf=0.95, label=FALSE, show.groups = "New22")
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#009E73",kind="sd", conf=0.95, label=FALSE, show.groups = "New21")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New21"),pch=17, col="#009E73")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New22"),pch=18, col="#00c690")
#add legend
legend(0.905,1.393, title=NULL, pch=c(17,18), col=c("#009E73", "#00c690"), cex=1.2, legend=c("2021 New cards", "2022 New cards"))
#bootstrapping and testing for differences between the groups (cardyear)
fit<-adonis2(com.matrix ~ CARDYEAR, data = env.matrix, permutations = 999, method="bray")
fit
#NMDS visualization with trap types by year
#8x9
plot(NMDSnew, disp='sites', type="n")
title(main="", adj = 0.01, line = -2, cex.main=2.5)
#8x9
plot(NMDSnew, disp='sites', type="n")
title(main="", adj = 0.01, line = -2, cex.main=2.5)
#add ellipsoids with ordiellipse
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#00c690",kind="sd", conf=0.95, label=FALSE, show.groups = "New22")
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#009E73",kind="sd", conf=0.95, label=FALSE, show.groups = "New21")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New21"),pch=17, col="#009E73")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New22"),pch=18, col="#00c690")
#add legend
legend(0.904,1.392, title=NULL, pch=c(17,18), col=c("#009E73", "#00c690"), cex=1.2, legend=c("2021 New cards", "2022 New cards"))
plot(NMDSnew, disp='sites', type="n")
title(main="", adj = 0.01, line = -2, cex.main=2.5)
#add ellipsoids with ordiellipse
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#00c690",kind="sd", conf=0.95, label=FALSE, show.groups = "New22")
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#009E73",kind="sd", conf=0.95, label=FALSE, show.groups = "New21")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New21"),pch=17, col="#009E73")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New22"),pch=18, col="#00c690")
#add legend
legend(0.90,1.39, title=NULL, pch=c(17,18), col=c("#009E73", "#00c690"), cex=1.2, legend=c("2021 New cards", "2022 New cards"))
plot(NMDSnew, disp='sites', type="n")
title(main="", adj = 0.01, line = -2, cex.main=2.5)
#add ellipsoids with ordiellipse
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#00c690",kind="sd", conf=0.95, label=FALSE, show.groups = "New22")
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#009E73",kind="sd", conf=0.95, label=FALSE, show.groups = "New21")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New21"),pch=17, col="#009E73")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New22"),pch=18, col="#00c690")
#add legend
legend(0.89,1.38, title=NULL, pch=c(17,18), col=c("#009E73", "#00c690"), cex=1.2, legend=c("2021 New cards", "2022 New cards"))
plot(NMDSnew, disp='sites', type="n")
title(main="", adj = 0.01, line = -2, cex.main=2.5)
#add ellipsoids with ordiellipse
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#00c690",kind="sd", conf=0.95, label=FALSE, show.groups = "New22")
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#009E73",kind="sd", conf=0.95, label=FALSE, show.groups = "New21")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New21"),pch=17, col="#009E73")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New22"),pch=18, col="#00c690")
#add legend
legend(0.88,1.37, title=NULL, pch=c(17,18), col=c("#009E73", "#00c690"), cex=1.2, legend=c("2021 New cards", "2022 New cards"))
plot(NMDSnew, disp='sites', type="n")
title(main="", adj = 0.01, line = -2, cex.main=2.5)
#add ellipsoids with ordiellipse
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#00c690",kind="sd", conf=0.95, label=FALSE, show.groups = "New22")
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#009E73",kind="sd", conf=0.95, label=FALSE, show.groups = "New21")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New21"),pch=17, col="#009E73")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New22"),pch=18, col="#00c690")
#add legend
legend(0.8,1.3, title=NULL, pch=c(17,18), col=c("#009E73", "#00c690"), cex=1.2, legend=c("2021 New cards", "2022 New cards"))
plot(NMDSnew, disp='sites', type="n")
title(main="", adj = 0.01, line = -2, cex.main=2.5)
#add ellipsoids with ordiellipse
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#00c690",kind="sd", conf=0.95, label=FALSE, show.groups = "New22")
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#009E73",kind="sd", conf=0.95, label=FALSE, show.groups = "New21")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New21"),pch=17, col="#009E73")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New22"),pch=18, col="#00c690")
#add legend
legend(0.85,1.35, title=NULL, pch=c(17,18), col=c("#009E73", "#00c690"), cex=1.2, legend=c("2021 New cards", "2022 New cards"))
plot(NMDSnew, disp='sites', type="n")
title(main="", adj = 0.01, line = -2, cex.main=2.5)
#add ellipsoids with ordiellipse
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#00c690",kind="sd", conf=0.95, label=FALSE, show.groups = "New22")
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#009E73",kind="sd", conf=0.95, label=FALSE, show.groups = "New21")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New21"),pch=17, col="#009E73")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New22"),pch=18, col="#00c690")
#add legend
legend(0.855,1.355, title=NULL, pch=c(17,18), col=c("#009E73", "#00c690"), cex=1.2, legend=c("2021 New cards", "2022 New cards"))
plot(NMDSnew, disp='sites', type="n")
title(main="", adj = 0.01, line = -2, cex.main=2.5)
#add ellipsoids with ordiellipse
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#00c690",kind="sd", conf=0.95, label=FALSE, show.groups = "New22")
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#009E73",kind="sd", conf=0.95, label=FALSE, show.groups = "New21")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New21"),pch=17, col="#009E73")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New22"),pch=18, col="#00c690")
#add legend
legend(0.858,1.358, title=NULL, pch=c(17,18), col=c("#009E73", "#00c690"), cex=1.2, legend=c("2021 New cards", "2022 New cards"))
plot(NMDSnew, disp='sites', type="n")
title(main="", adj = 0.01, line = -2, cex.main=2.5)
#add ellipsoids with ordiellipse
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#00c690",kind="sd", conf=0.95, label=FALSE, show.groups = "New22")
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#009E73",kind="sd", conf=0.95, label=FALSE, show.groups = "New21")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New21"),pch=17, col="#009E73")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New22"),pch=18, col="#00c690")
#add legend
legend(0.859,1.358, title=NULL, pch=c(17,18), col=c("#009E73", "#00c690"), cex=1.2, legend=c("2021 New cards", "2022 New cards"))
plot(NMDSnew, disp='sites', type="n")
title(main="", adj = 0.01, line = -2, cex.main=2.5)
#add ellipsoids with ordiellipse
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#00c690",kind="sd", conf=0.95, label=FALSE, show.groups = "New22")
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#009E73",kind="sd", conf=0.95, label=FALSE, show.groups = "New21")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New21"),pch=17, col="#009E73")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New22"),pch=18, col="#00c690")
#add legend
legend(0.86,1.358, title=NULL, pch=c(17,18), col=c("#009E73", "#00c690"), cex=1.2, legend=c("2021 New cards", "2022 New cards"))
plot(NMDSnew, disp='sites', type="n")
title(main="", adj = 0.01, line = -2, cex.main=2.5)
#add ellipsoids with ordiellipse
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#00c690",kind="sd", conf=0.95, label=FALSE, show.groups = "New22")
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#009E73",kind="sd", conf=0.95, label=FALSE, show.groups = "New21")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New21"),pch=17, col="#009E73")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New22"),pch=18, col="#00c690")
#add legend
legend(0.86,1.361, title=NULL, pch=c(17,18), col=c("#009E73", "#00c690"), cex=1.2, legend=c("2021 New cards", "2022 New cards"))
plot(NMDSnew, disp='sites', type="n")
title(main="", adj = 0.01, line = -2, cex.main=2.5)
#add ellipsoids with ordiellipse
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#00c690",kind="sd", conf=0.95, label=FALSE, show.groups = "New22")
ordiellipse(NMDSnew, env.matrix$CARDYEAR, draw="polygon", col="#009E73",kind="sd", conf=0.95, label=FALSE, show.groups = "New21")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New21"),pch=17, col="#009E73")
points(NMDSnew, display="sites", select=which(env.matrix$CARDYEAR=="New22"),pch=18, col="#00c690")
#add legend
legend(0.86,1.363, title=NULL, pch=c(17,18), col=c("#009E73", "#00c690"), cex=1.2, legend=c("2021 New cards", "2022 New cards"))
pdf("combined NMDSs.pdf", height=10, width=13)
par(mfrow=c(1,3), mar=c(4.1, 4.8, 1.5, 8.1),xpd=TRUE)
plot(NMDS21, disp='sites', type="n")
insects21 <- read.csv("https://raw.githubusercontent.com/BahlaiLab/KBS_sticky-cards/main/2021_LTER_for_analyses.csv", na.strings = NULL)
insects21 <- read.csv("https://raw.githubusercontent.com/BahlaiLab/KBS_sticky-cards/main/2021_LTER_for_analyses_change%20to%20Leps.csv", na.strings = NULL)
#change week, CARD, TREAT, and STATION to factor
insects21$week <- as.factor(insects21$week)
insects21$CARD <- as.factor(insects21$CARD)
insects21$TREAT <- as.factor(insects21$TREAT)
insects21$STATION <- as.factor(insects21$STATION)
str(insects21)
summary(insects21)
###
#NMDS of insect community between card types
library (vegan)
#Create matrix of environmental variables
env.matrix<-insects21[c(1:4,30)]
#create matrix of community variables
com.matrix<-insects21[c(5:29)]
#ordination by NMDS
NMDS21<-metaMDS(com.matrix, distance="bray", k=2, autotransform=TRUE, trymax=300) #stress=.23
NMDS21
old20 <- insects_all[which(insects_all$CARDYEAR=="Old20"),]
old21 <- insects_all[which(insects_all$CARDYEAR=="Old21"),]
#combine
library (plyr)
old20_old21 <- rbind.fill (old20, old21)
insects.abun <- rowSums(old20_old21[,6:24])
old20_old21$abundance <- insects.abun
#then remove rows = zero
old20_old21_nonzero <- old20_old21[rowSums(old20_old21[26])>0,]
str(old20_old21_nonzero)
#Create matrix of environmental variables
env.matrix<-old20_old21_nonzero[c(1:5,25)]
#create matrix of community variables
com.matrix<-old20_old21_nonzero[c(6:24)]
#ordination by NMDS
NMDSold<-metaMDS(com.matrix, distance="bray", k=2, autotransform=TRUE, trymax=100) #stress=.18
